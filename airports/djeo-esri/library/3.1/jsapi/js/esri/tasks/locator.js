/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/tasks/_task"],function(_1,_2,_3){_2.provide("esri.tasks.locator");_2.require("esri.tasks._task");_2.declare("esri.tasks.Locator",esri.tasks._Task,{constructor:function(_4){this._geocodeHandler=_2.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=_2.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=_2.hitch(this,this._reverseGeocodeHandler);},outSpatialReference:null,setOutSpatialReference:function(sr){this.outSpatialReference=sr;},_geocodeHandler:function(_5,io,_6,_7,_8){try{var _9=_5.candidates,_a,_b=[],i,il=_9.length,sr=_5.spatialReference;for(i=0;i<il;i++){_a=_9[i];_b[i]=new esri.tasks.AddressCandidate(_a);var _c=_b[i].location;if(sr&&_c&&!_c.spatialReference){_c.setSpatialReference(new esri.SpatialReference(sr));}}this._successHandler([_b],"onAddressToLocationsComplete",_6,_8);}catch(err){this._errorHandler(err,_7,_8);}},_geocodeAddressesHandler:function(_d,io,_e,_f,dfd){try{var _10=_d.locations,out=[],i,il=_10.length,sr=_d.spatialReference;for(i=0;i<il;i++){out[i]=new esri.tasks.AddressCandidate(_10[i]);var _11=out[i].location;if(sr&&_11&&!_11.spatialReference){_11.setSpatialReference(new esri.SpatialReference(sr));}}this._successHandler([out],"onAddressesToLocationsComplete",_e,dfd);}catch(err){this._errorHandler(err,_f,dfd);}},addressToLocations:function(_12,_13,_14,_15,_16){if(_12.address){_15=_14;_14=_13;_13=_12.outFields;_16=_12.searchExtent;_12=_12.address;}if(_16){_16=_16._normalize(true);}var _17=this.outSpatialReference;var _18=this._encode(_2.mixin({},this._url.query,_12,{f:"json",outSR:_17&&_2.toJson(_17.toJson()),outFields:(_13&&_13.join(","))||null,searchExtent:_16&&_2.toJson(_16.toJson())})),_19=this._geocodeHandler,_1a=this._errorHandler;var dfd=new _2.Deferred(esri._dfdCanceller);dfd._pendingDfd=esri.request({url:this._url.path+"/findAddressCandidates",content:_18,callbackParamName:"callback",load:function(r,i){_19(r,i,_14,_15,dfd);},error:function(r){_1a(r,_15,dfd);}});return dfd;},addressesToLocations:function(_1b,_1c,_1d){var _1e=this.outSpatialReference;var _1f=[],_20=_1b.addresses;_2.forEach(_20,function(_21,idx){_1f.push({attributes:_21});});var _22=this._encode(_2.mixin({},this._url.query,{addresses:_2.toJson({records:_1f})},{f:"json",outSR:_1e&&_2.toJson(_1e.toJson())})),_23=this._geocodeAddressesHandler,_24=this._errorHandler;var dfd=new _2.Deferred(esri._dfdCanceller);dfd._pendingDfd=esri.request({url:this._url.path+"/geocodeAddresses",content:_22,callbackParamName:"callback",load:function(r,i){_23(r,i,_1c,_1d,dfd);},error:function(r){_24(r,_1d,dfd);}});return dfd;},_reverseGeocodeHandler:function(_25,io,_26,_27,dfd){try{var _28=new esri.tasks.AddressCandidate({address:_25.address,location:_25.location,score:100});this._successHandler([_28],"onLocationToAddressComplete",_26,dfd);}catch(err){this._errorHandler(err,_27,dfd);}},locationToAddress:function(_29,_2a,_2b,_2c){if(_29&&this.normalization){_29=_29.normalize();}var _2d=this.outSpatialReference;var _2e=this._encode(_2.mixin({},this._url.query,{outSR:_2d&&_2.toJson(_2d.toJson()),location:_29&&_2.toJson(_29.toJson()),distance:_2a,f:"json"})),_2f=this._reverseGeocodeHandler,_30=this._errorHandler;var dfd=new _2.Deferred(esri._dfdCanceller);dfd._pendingDfd=esri.request({url:this._url.path+"/reverseGeocode",content:_2e,callbackParamName:"callback",load:function(r,i){_2f(r,i,_2b,_2c,dfd);},error:function(r){_30(r,_2c,dfd);}});return dfd;},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});_2.declare("esri.tasks.AddressCandidate",null,{constructor:function(_31){_2.mixin(this,_31);this.location=new esri.geometry.Point(this.location);}});});