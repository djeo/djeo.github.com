/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/geometry,esri/utils"],function(_1,_2,_3){_2.provide("esri.layers.agscommon");_2.require("esri.geometry");_2.require("esri.utils");_2.declare("esri.layers.ArcGISMapServiceLayer",null,{constructor:function(_4,_5){this.layerInfos=[];var _6=(this._params={}),_7=this._url.query?this._url.query.token:null;if(_7){_6.token=_7;}},_load:function(){esri.request({url:this._url.path,content:_2.mixin({f:"json"},this._params),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});},spatialReference:null,initialExtent:null,fullExtent:null,description:null,units:null,_initLayer:function(_8,io){try{this._findCredential();var _9=(this.credential&&this.credential.ssl)||(_8&&_8._ssl);if(_9){this._useSSL();}this.description=_8.description;this.copyright=_8.copyrightText;this.spatialReference=_8.spatialReference&&new esri.SpatialReference(_8.spatialReference);this.initialExtent=_8.initialExtent&&new esri.geometry.Extent(_8.initialExtent);this.fullExtent=_8.fullExtent&&new esri.geometry.Extent(_8.fullExtent);this.units=_8.units;this.maxRecordCount=_8.maxRecordCount;this.maxImageHeight=_8.maxImageHeight;this.maxImageWidth=_8.maxImageWidth;this.supportsDynamicLayers=_8.supportsDynamicLayers;var _a=(this.layerInfos=[]),_b=_8.layers,_c=(this._defaultVisibleLayers=[]);_2.forEach(_b,function(_d,i){_a[i]=new esri.layers.LayerInfo(_d);if(_d.defaultVisibility){_c.push(_d.id);}});if(!this.visibleLayers){this.visibleLayers=_c;}this.version=_8.currentVersion;if(!this.version){var _e;if("capabilities" in _8||"tables" in _8){_e=10;}else{if("supportedImageFormatTypes" in _8){_e=9.31;}else{_e=9.3;}}this.version=_e;}this.capabilities=_8.capabilities;if(esri._isDefined(_8.minScale)&&!this._hasMin){this.setMinScale(_8.minScale);}if(esri._isDefined(_8.maxScale)&&!this._hasMax){this.setMaxScale(_8.maxScale);}}catch(e){this._errorHandler(e);}}});_2.declare("esri.layers.LayerInfo",null,{constructor:function(_f){_2.mixin(this,_f);},toJson:function(){var _10={defaultVisibility:this.defaultVisibility,id:this.id,maxScale:this.maxScale,minScale:this.minScale,name:this.name,parentLayerId:this.parentLayerId,subLayerIds:this.subLayerIds};return esri._sanitize(_10);}});_2.declare("esri.layers.TimeInfo",null,{constructor:function(_11){if(_11!==null){_2.mixin(this,_11);if(_11.exportOptions){this.exportOptions=new esri.layers.LayerTimeOptions(_11.exportOptions);}this.timeExtent=new esri.TimeExtent(_11.timeExtent);this.timeReference=new esri.layers.TimeReference(_11.timeReference);}}});_2.mixin(esri.layers.TimeInfo,{UNIT_CENTURIES:"esriTimeUnitsCenturies",UNIT_DAYS:"esriTimeUnitsDays",UNIT_DECADES:"esriTimeUnitsDecades",UNIT_HOURS:"esriTimeUnitsHours",UNIT_MILLISECONDS:"esriTimeUnitsMilliseconds",UNIT_MINUTES:"esriTimeUnitsMinutes",UNIT_MONTHS:"esriTimeUnitsMonths",UNIT_SECONDS:"esriTimeUnitsSeconds",UNIT_UNKNOWN:"esriTimeUnitsUnknown",UNIT_WEEKS:"esriTimeUnitsWeeks",UNIT_YEARS:"esriTimeUnitsYears"});_2.declare("esri.layers.LayerTimeOptions",null,{constructor:function(_12){if(_12){_2.mixin(this,_12);}},toJson:function(){var _13={timeDataCumulative:this.timeDataCumulative,timeOffset:this.timeOffset,timeOffsetUnits:this.timeOffsetUnits,useTime:this.useTime};return esri._sanitize(_13);}});_2.declare("esri.layers.TimeReference",null,{constructor:function(_14){if(_14){_2.mixin(this,_14);}}});_2.declare("esri.layers.Field",null,{constructor:function(_15){if(_15&&_2.isObject(_15)){this.name=_15.name;this.type=_15.type;this.alias=_15.alias;this.length=_15.length;this.editable=_15.editable;this.nullable=_15.nullable;var _16=_15.domain;if(_16&&_2.isObject(_16)){switch(_16.type){case "range":this.domain=new esri.layers.RangeDomain(_16);break;case "codedValue":this.domain=new esri.layers.CodedValueDomain(_16);break;}}}}});_2.declare("esri.layers.Domain",null,{constructor:function(_17){if(_17&&_2.isObject(_17)){this.name=_17.name;this.type=_17.type;}},toJson:function(){return esri._sanitize({name:this.name,type:this.type});}});_2.declare("esri.layers.RangeDomain",[esri.layers.Domain],{constructor:function(_18){if(_18&&_2.isObject(_18)){this.minValue=_18.range[0];this.maxValue=_18.range[1];}},toJson:function(){var _19=this.inherited(arguments);_19.range=[this.minValue,this.maxValue];return esri._sanitize(_19);}});_2.declare("esri.layers.CodedValueDomain",[esri.layers.Domain],{constructor:function(_1a){if(_1a&&_2.isObject(_1a)){this.codedValues=_1a.codedValues;}},toJson:function(){var _1b=this.inherited(arguments);_1b.codedValues=_2.clone(this.codedValues);return esri._sanitize(_1b);}});_2.declare("esri.layers.InheritedDomain",[esri.layers.Domain],{});_2.declare("esri.layers.LayerSource",null,{type:null,constructor:function(_1c){if(_1c){_2.mixin(this,_1c);}},toJson:function(){}});_2.declare("esri.layers.LayerMapSource",esri.layers.LayerSource,{type:"mapLayer",toJson:function(){var _1d={type:"mapLayer",mapLayerId:this.mapLayerId,gdbVersion:this.gdbVersion};return esri._sanitize(_1d);}});_2.declare("esri.layers.LayerDataSource",esri.layers.LayerSource,{type:"dataLayer",toJson:function(){var _1e={type:"dataLayer",dataSource:this.dataSource&&this.dataSource.toJson()};return esri._sanitize(_1e);}});_2.declare("esri.layers.DataSource",null,{constructor:function(_1f){if(_1f){_2.mixin(this,_1f);}},toJson:function(){}});_2.declare("esri.layers.TableDataSource",esri.layers.DataSource,{toJson:function(){var _20={type:"table",workspaceId:this.workspaceId,dataSourceName:this.dataSourceName,gdbVersion:this.gdbVersion};return esri._sanitize(_20);}});_2.declare("esri.layers.QueryDataSource",esri.layers.DataSource,{toJson:function(){var _21={type:"queryTable",workspaceId:this.workspaceId,query:this.query,oidFields:this.oidFields&&this.oidFields.join(),spatialReference:this.spatialReference&&this.spatialReference.toJson()};if(this.geometryType){var _22;if(this.geometryType.toLowerCase()==="point"){_22="esriGeometryPoint";}else{if(this.geometryType.toLowerCase()==="multipoint"){_22="esriGeometryMultipoint";}else{if(this.geometryType.toLowerCase()==="polyline"){_22="esriGeometryPolyline";}else{if(this.geometryType.toLowerCase()==="polygon"){_22="esriGeometryPolygon";}else{_22=this.geometryType;}}}}_21.geometryType=_22;}return esri._sanitize(_21);}});_2.declare("esri.layers.JoinDataSource",esri.layers.DataSource,{toJson:function(){var _23={type:"joinTable",leftTableSource:this.leftTableSource&&this.leftTableSource.toJson(),rightTableSource:this.rightTableSource&&this.rightTableSource.toJson(),leftTableKey:this.leftTableKey,rightTableKey:this.rightTableKey};var _24;if(this.joinType.toLowerCase()==="left-outer-join"){_24="esriLeftOuterJoin";}else{if(this.joinType.toLowerCase()==="left-inner-join"){_24="esriLeftInnerJoin";}else{_24=this.joinType;}}_23.joinType=_24;return esri._sanitize(_23);}});_2.declare("esri.layers.RasterDataSource",esri.layers.DataSource,{toJson:function(){var _25={type:"raster",workspaceId:this.workspaceId,dataSourceName:this.dataSourceName};return esri._sanitize(_25);}});_2.declare("esri.layers.DynamicLayerInfo",esri.layers.LayerInfo,{defaultVisibility:true,parentLayerId:-1,maxScale:0,minScale:0,constructor:function(_26){if(_26&&!_26.source){var _27=new esri.layers.LayerMapSource();_27.mapLayerId=this.id;this.source=_27;}},toJson:function(){var _28=this.inherited(arguments);_28.source=this.source&&this.source.toJson();return esri._sanitize(_28);}});_2.declare("esri.layers.LayerDrawingOptions",null,{constructor:function(_29){if(_29){_2.mixin(this,_29);}},toJson:function(){var _2a={renderer:this.renderer&&this.renderer.toJson(),transparency:this.transparency,scaleSymbols:this.scaleSymbols,showLabels:this.showLabels};return esri._sanitize(_2a);}});});