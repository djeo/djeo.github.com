/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/dijit/_TouchBase"],function(_1,_2,_3){_2.provide("esri.dijit.Gallery");_2.require("esri.dijit._TouchBase");_2.declare("esri.dijit.Gallery",null,{container:null,_items:[],_currentIndex:0,_left:0,_offset:10,_slideDiv:null,_thumbnailStyle:"default",_focusedIndex:null,_selectedIndex:-1,_slideStep:1,_showTitle:true,constructor:function(_4,_5){this.container=_2.byId(_5);this._touchBase=esri.dijit._TouchBase(this.container,null);this._slideDiv=_2.create("div",{"class":"slideContainer"},this.container,"first");this.events=[_2.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler),_2.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler),_2.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler),_2.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._resizeHandle=_2.connect(window,"onorientationchange",_2.hitch(this,this._onResizeHandler));this._items=_4.items;if(_4.thumbnailStyle&&_4.thumbnailStyle=="small"){this._thumbnailStyle="small";this._offset=4;this._slideStep=3;this._thumbnailWidth=100;}else{this._thumbnailStyle="default";this._offset=10;this._slideStep=1;this._thumbnailWidth=200;}if(_4.showTitle==false){this._showTitle=false;}this.container.setAttribute((document.all?"className":"class"),"esriMobileGallery");var _6,_7;for(var i=0;i<this._items.length;i++){var _8,_9,_a,_b;_8=_2.create("div",{"class":"thumbnailcontainer"},this._slideDiv);_b=_2.create("img",{"class":"thumbnail",src:this._items[i].thumbnailUrl},_8);_b._index=i;_b._item=this._items[i];_9=_2.create("div",{"class":"title","innerHTML":this._items[i].title},_8);_a=_2.create("div",{"class":"title"},_8);if(this._thumbnailStyle=="small"){_2.addClass(_8,"small");_2.addClass(_b,"small");_2.addClass(_9,"small");_2.addClass(_a,"small");_2.addClass(this._slideDiv,"small");}if(!this._showTitle){_9.style.display="none";}_7=_2.contentBox(_8).h;if(!_6){_6=_7;}if(_7>_6){_6=_7;}}for(var i=0;i<this._slideDiv.childNodes.length;i++){_2.contentBox(this._slideDiv.childNodes[i],{h:_6});}this._thumbnailWidth=_2.contentBox(this._slideDiv.childNodes[0]).w;this._slideDiv.style.width=this._items.length*(this._thumbnailWidth+this._offset)+"px";if(window.orientation){if(window.orientation==90||window.orientation==-90){_2.addClass(this.container,"galleryLandscape");}}this._calculateSlideStep();},startup:function(){this._focusedIndex=0;this.onFocus(this._items[this._focusedIndex]);},destroy:function(){_2.forEach(this.events,_2.disconnect);_2.disconnect(this._resizeHandle);this._touchBase=null;_2.query("img",this.container).forEach(function(_c){_c._index=null;_c._item=null;_2.destroy(_c);_c=null;});this._items=null;_2.destroy(this._slideDiv);_2.destroy(this.container);this.container=this._slideDiv=null;},setFocus:function(_d){if(!_d){return;}for(var i=0,il=this._items.length;i<il;i++){if(this._items[i]==_d){this._setFocus(i);this.onFocus(this._items[this._focusedIndex]);}}},select:function(_e){if(!_e){return;}for(var i=0,il=this._items.length;i<il;i++){if(this._items[i]==_e){if(this._selectedIndex!=-1){this.onUnSelect(this._items[this._selectedIndex]);}this._select(i);this.onSelect(this._items[this._selectedIndex]);break;}}},getFocusedItem:function(){return this._items[this._focusedIndex];},getSelectedItem:function(){return this._items[this._selectedIndex];},next:function(){this._next();this._startTransition();this.onFocus(this._items[this._currentIndex]);},previous:function(){this._previous();this._startTransition();this.onFocus(this._items[this._currentIndex]);},getTitleNode:function(_f){if(!_f){return;}for(var i=0,il=this._items.length;i<il;i++){if(this._items[i]==_f){return this._slideDiv.childNodes[i].childNodes[1];break;}}},getInfoNode:function(_10){if(!_10){return;}for(var i=0,il=this._items.length;i<il;i++){if(this._items[i]==_10){return this._slideDiv.childNodes[i].childNodes[2];break;}}},showTitle:function(_11){if(!_11){return;}for(var i=0,il=this._items.length;i<il;i++){if(this._items[i]==_11){this._slideDiv.childNodes[i].childNodes[1].style.display="block";break;}}},hideTitle:function(_12){if(!_12){return;}for(var i=0,il=this._items.length;i<il;i++){if(this._items[i]==_12){this._slideDiv.childNodes[i].childNodes[1].style.display="none";break;}}},onFocus:function(_13){},onSelect:function(_14){},onUnSelect:function(_15){},_onClickHandler:function(e){if(e.target instanceof HTMLImageElement){var _16=e.target._index;if(this._selectedIndex!=-1){this.onUnSelect(this._items[this._selectedIndex]);}this._select(_16);this.onSelect(this._items[this._selectedIndex]);}},_onTouchStartHandler:function(e){this._moveDirection=null;this._left=this._currentIndex*(-(this._thumbnailWidth)-this._offset);this._slideDiv.style.WebkitTransitionDuration="0s";},_onTouchMoveHandler:function(e){if(!this._moveDirection){if(Math.abs(e.curY)>Math.abs(e.curX)){this._moveDirection="vertical";}else{this._moveDirection="horizontal";}}if(this._moveDirection=="vertical"){if(!this._touchBase._preventDefault==false){this._touchBase._preventDefault=false;}return;}else{if(this._moveDirection=="horizontal"){if(!this._touchBase._preventDefault){this._touchBase._preventDefault=true;}var _17=this._left+e.curX;this._slideDiv.style.webkitTransform="translate3d("+_17+"px, 0, 0)";}}},_onTouchEndHandler:function(e){var _18=this._currentIndex;this._slideDiv.style.WebkitTransitionDuration="0.5s";if(e.swipeDirection=="left"){this._next();}else{if(e.swipeDirection=="right"){this._previous();}}this._left=this._currentIndex*(-(this._thumbnailWidth)-this._offset);this._slideDiv.style.webkitTransform="translate3d("+this._left+"px, 0, 0)";if(_18!=this._currentIndex){this.onFocus(this._items[this._currentIndex]);}},_onResizeHandler:function(e){var _19=window.orientation;switch(_19){case 0:_2.removeClass(this.container,"galleryLandscape");break;case 90:case -90:_2.addClass(this.container,"galleryLandscape");break;}this._calculateSlideStep();},_startTransition:function(){this._slideDiv.style.WebkitTransitionDuration="0.5s";this._left=this._currentIndex*(-(this._thumbnailWidth)-this._offset);this._slideDiv.style.webkitTransform="translate3d("+this._left+"px, 0, 0)";},_markUnSelected:function(_1a){_2.removeClass(_1a,"selected");_2.removeClass(_1a.parentNode,"selected");_2.removeClass(_1a.parentNode.childNodes[1],"selected");_2.removeClass(_1a.parentNode.childNodes[2],"selected");},_markSelected:function(_1b){_2.addClass(_1b,"selected");_2.addClass(_1b.parentNode,"selected");_2.addClass(_1b.parentNode.childNodes[1],"selected");_2.addClass(_1b.parentNode.childNodes[2],"selected");},_next:function(){if(this._currentIndex+this._slideStep<this._items.length){this._currentIndex+=this._slideStep;this._focusedIndex=this._currentIndex;}},_previous:function(){if(this._currentIndex-this._slideStep>=0){this._currentIndex-=this._slideStep;}this._focusedIndex=this._currentIndex;},_setFocus:function(_1c){this._focusedIndex=_1c;this._currentIndex=Math.floor(_1c/this._slideStep)*this._slideStep;this._startTransition();},_select:function(_1d){if(this._selectedIndex!=-1){this._markUnSelected(this._slideDiv.childNodes[this._selectedIndex].childNodes[0]);}this._selectedIndex=_1d;this._markSelected(this._slideDiv.childNodes[this._selectedIndex].childNodes[0]);},_calculateSlideStep:function(){var _1e=_2.contentBox(this.container);var _1f=Math.floor((_1e.w+this._offset)/(this._thumbnailWidth+this._offset));if(_1f>=1){var _20=_1e.w-(this._thumbnailWidth+this._offset)*_1f;if(_20>0){this._slideDiv.style.marginLeft=Math.floor(_20/2)+"px";}else{this._slideDiv.style.marginLeft="0px";}this._slideStep=_1f;}else{this._slideStep=1;}if(this._selectedIndex!=-1){this._setFocus(this._selectedIndex);}else{this._setFocus(this._focusedIndex);}}});});