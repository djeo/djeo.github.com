/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/layers/layer,dojox/gfx,esri/graphic,esri/renderer"],function(_1,_2,_3){_2.provide("esri.layers.graphics");_2.require("esri.layers.layer");_2.require("dojox.gfx");_2.require("esri.graphic");_2.require("esri.renderer");_2.declare("esri.layers._GraphicsContainer",null,{_setMap:function(_4,_5){var es,_6=(this._connects=[]);this._map=_4;if(_3.gfx.renderer.toLowerCase().indexOf("canvas")!==-1){es=_2.create("div",{style:"overflow: visible; position: absolute;"},_5);this._surface={getEventSource:function(){return es;}};_6.push(_2.connect(es,"onmousedown",this,this._canvasDownHandler));_6.push(_2.connect(es,"onmouseup",this,this._canvasUpHandler));_6.push(_2.connect(es,"onclick",this,this._canvasClickHandler));esri.layers._GraphicsLayer.prototype._canvas=true;}else{var _7=(this._surface=_3.gfx.createSurface(_5,_4.width,_4.height));es=_7.getEventSource();_2.style((es=(_2.isIE<9)?es.parentNode:es),{overflow:"visible",position:"absolute"});}_6.push(_2.connect(_4,"onResize",this,"_onResizeHandler"));return es;},_onResizeHandler:function(_8,_9,_a){var es=this._surface.getEventSource(),_b=this._map,_c;if(_2.isIE<9){_2.style((es=es.parentNode),{width:_9+"px",height:_a+"px",clip:"rect(0px "+_9+"px "+_a+"px 0px)"});}_2.attr(es,"width",_9);_2.attr(es,"height",_a);if(!this._surface.declaredClass){_2.forEach(es.childNodes,function(_d){_2.attr(_d,"width",_9);_2.attr(_d,"height",_a);});}if(_b.loaded){if(!_b.graphics.suspended){_b.graphics._resized=true;}_2.forEach(_b.graphicsLayerIds,function(_e){_c=_b.getLayer(_e);if(!_c.suspended){_c._resized=true;}});}},_cleanUp:function(){_2.forEach(this._connects,_2.disconnect,_2);this._map=this._surface=null;},_processEvent:function(_f){var map=this._map;_f.screenPoint=new esri.geometry.Point(_f.pageX-map.position.x,_f.pageY-map.position.y);_f.mapPoint=map.toMap(_f.screenPoint);},_canvasDownHandler:function(evt){this._processEvent(evt);this._downPt=evt.screenPoint.x+","+evt.screenPoint.y;},_canvasUpHandler:function(evt){this._processEvent(evt);this._upPt=evt.screenPoint.x+","+evt.screenPoint.y;},_tolerance:15,_canvasClickHandler:function(evt){if(!this._downPt||!this._upPt||this._downPt!==this._upPt){return;}this._processEvent(evt);var map=this._map;var _10=_2.map(map.graphicsLayerIds,function(id){return map.getLayer(id);});_10.push(map.graphics);_10.reverse();_10=_2.filter(_10,function(_11){return _11.loaded&&_11._mouseEvents&&!_11.suspended&&(!esri._isDefined(_11.opacity)||_11.opacity>0);});var _12=evt.screenPoint,geo=esri.geometry,_13=this._tolerance;var _14=_12.x-_13,_15=_12.y+_13;var _16=_12.x+_13,_17=_12.y-_13;var _18=new geo.Extent(_14,_17,_16,_15);var _19=map.toMap(new geo.Point(_14,_15));var _1a=map.toMap(new geo.Point(_16,_17));var _1b=new geo.Extent(_19.x,_19.y,_1a.x,_1a.y);var _1c,_1d=esri.isTouchEnabled;_2.some(_10,function(_1e){var _1f=_2.filter(_1e.graphics,function(_20){var _21=_20.getDojoShape();if(!_20.visible||!_21){return false;}var _22=_21.getTransformedBoundingBox();if(_22){var _23=new geo.Extent(_22[0].x,_22[0].y,_22[2].x,_22[2].y);return _1d?_23.intersects(_18):_23.contains(_12);}else{return _2.some(_21.children||[],function(_24){_22=_24.getTransformedBoundingBox();var _25=new geo.Extent(_22[0].x,_22[0].y,_22[2].x,_22[2].y);return _1d?_25.intersects(_18):_25.contains(_12);});}});if(_1f.length>0){var _26;_2.some(_1f,function(_27){if(_27.geometry&&_1b.intersects(_27.geometry)){_26=_27;return true;}return false;});if(_26){_1c=_26;return true;}}return false;});if(_1c){var _28=_1c.getLayer();if(_28){evt.graphic=_1c;_28.onClick(evt);}}}});_2.declare("esri.layers._GraphicsLayer",esri.layers.Layer,{constructor:function(_29){if(_29&&(_2.isString(_29)||(_2.isObject(_29)&&_29.layerDefinition))){_29=arguments[1];}this._params=_2.mixin({displayOnPan:true,drawMode:true},_29||{});this.infoTemplate=_29&&_29.infoTemplate;this.graphics=[];this._draw=_2.hitch(this,this._draw);this._refresh=_2.hitch(this,this._refresh);},setDrawMode:function(_2a){this._params.drawMode=_2a;},renderer:null,_setMap:function(map,_2b){this.inherited(arguments);this._map=map;var _2c=map.spatialReference;this._wrap=map.wrapAround180;this._srInfo=_2c._getInfo();if(!this._canvas){this._div=_2b.createGroup();}else{_2b=_3.gfx.createSurface(_2b.getEventSource(),map.width,map.height);_2.style(_2b.rawNode,"position","absolute");this._div=_2b.createGroup();this._div.getEventSource=function(){return _2b.rawNode;};this._renderProto=this._div.constructor.prototype._render;this._div._render=_2.hitch(this,this._canvasRender);}this._div.getEventSource().id=this.id+"_layer";this.evaluateSuspension();if(this.suspended&&!map.loaded){var _2d=_2.connect(map,"onLoad",this,function(){_2.disconnect(_2d);_2d=null;this.evaluateSuspension();});}var op=this.opacity;if(esri._isDefined(op)&&op<1){this.setOpacity(op,true);}return this._div;},_unsetMap:function(map,_2e){_2.forEach(this.graphics,function(g){g._shape=null;});if(!this._canvas){this._div.clear();_2e.remove(this._div);_2.destroy(this._div.getEventSource());}else{_2e=this._div.getParent();_2e._parent={};_2.destroy(_2e.rawNode);_2e.destroy();}this._map=this._div=null;clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors();this.inherited(arguments);},_onZoomStartHandler:function(){esri.hide(this._div.getEventSource());},_onExtentChangeHandler:function(_2f,_30,_31,lod){clearTimeout(this._wakeTimer);this._wakeTimer=null;if(_31){var _32=this._map.__visibleRect,_33=this._div;this._refresh(true);_33.setTransform(_3.gfx.matrix.translate({x:_32.x,y:_32.y}));if(this._renderProto&&_33.surface.pendingRender){this._dirty=true;}else{if(!this.suspended){esri.show(_33.getEventSource());}}}else{if(this._resized){this._refresh(false);this._resized=false;}}if(this.graphics.length>0){this.onUpdate();}},_canvasRender:function(){var _34=this._div;if(this._dirty){delete this._dirty;if(!this.suspended){esri.show(_34.getEventSource());}}return this._renderProto.apply(_34,arguments);},_refresh:function(_35){var gs=this.graphics,il=gs.length,i,_36=this._draw;for(i=0;i<il;i++){_36(gs[i],_35);}},refresh:function(){this._refresh(true);},_onPanHandler:function(_37,_38){this._panDx=_38.x;this._panDy=_38.y;var _39=this._map.__visibleRect;this._div.setTransform(_3.gfx.matrix.translate({x:_39.x+_38.x,y:_39.y+_38.y}));},_onPanEndUpdateHandler:function(_3a,_3b){if(!this._params._child&&(_3b.x!==this._panDx||_3b.y!==this._panDy)){var _3c=this._map.__visibleRect;this._div.setTransform(_3.gfx.matrix.translate({x:_3c.x,y:_3c.y}));}this._refresh(false);if(this.graphics.length){this.onUpdate();}},_onPanStartHandler:function(){esri.hide(this._div.getEventSource());},_onPanEndHandler:function(){var _3d=this._map.__visibleRect,_3e=this._div;_3e.setTransform(_3.gfx.matrix.translate({x:_3d.x,y:_3d.y}));this._refresh(false);if(this._renderProto&&_3e.surface.pendingRender){this._dirty=true;}else{esri.show(_3e.getEventSource());}if(this.graphics.length){this.onUpdate();}},onSuspend:function(){this.inherited(arguments);esri.hide(this._div.getEventSource());clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors();},onResume:function(){this.inherited(arguments);this._enableDrawConnectors();this._wakeTimer=this._wakeTimer||setTimeout(_2.hitch(this,function(){if(!this.suspended){this._onExtentChangeHandler(null,null,true);}}),0);},_enableDrawConnectors:function(){var map=this._map,dc=_2.connect;this._disableDrawConnectors();if(this._params.displayOnPan){if(!this._params._child){this._onPanHandler_connect=dc(map,"onPan",this,"_onPanHandler");}this._onPanEndHandler_connect=dc(map,"onPanEnd",this,"_onPanEndUpdateHandler");}else{this._onPanStartHandler_connect=dc(map,"onPanStart",this,"_onPanStartHandler");this._onPanEndHandler_connect=dc(map,"onPanEnd",this,"_onPanEndHandler");}this._onZoomStartHandler_connect=dc(map,"onZoomStart",this,"_onZoomStartHandler");this._onExtentChangeHandler_connect=dc(map,"onExtentChange",this,"_onExtentChangeHandler");},_disableDrawConnectors:function(){var dd=_2.disconnect;dd(this._onExtentChangeHandler_connect);dd(this._onZoomStartHandler_connect);dd(this._onPanHandler_connect);dd(this._onPanStartHandler_connect);dd(this._onPanEndHandler_connect);this._onExtentChangeHandler_connect=this._onZoomStartHandler_connect=this._onPanHandler_connect=this._onPanStartHandler_connect=this._onPanEndHandler_connect=null;},_updateExtent:function(_3f){var _40=_3f.geometry,eg=esri.geometry;if(!_40){_3f._extent=null;return;}var _41=(_3f._extent=_40.getExtent());if(!_41){var x,y;if(_40 instanceof eg.Point){x=_40.x;y=_40.y;}else{if(_40 instanceof eg.Multipoint){x=_40.points[0][0];y=_40.points[0][1];}else{_3f._extent=null;return;}}_3f._extent=new eg.Extent(x,y,x,y,_40.spatialReference);}},_intersects:function(map,_42,_43){if(this._wrap&&!_43){var _44=[],_45=map._getFrameWidth(),_46=this._srInfo,_47,_48=map._clip?map._getAvailExtent():map.extent,_49=_48._getParts(_46),g,m,f,gl,ml,fl,_4a,_4b,_4c=[],_4d=_42._partwise;if(_4d&&_4d.length){_47=[];for(g=0,gl=_4d.length;g<gl;g++){_47=_47.concat(_4d[g]._getParts(_46));}}else{_47=_42._getParts(_46);}for(g=0,gl=_47.length;g<gl;g++){_4a=_47[g];for(m=0,ml=_49.length;m<ml;m++){_4b=_49[m];if(_4b.extent.intersects(_4a.extent)){for(f=0,fl=_4a.frameIds.length;f<fl;f++){_44.push((_4b.frameIds[0]-_4a.frameIds[f])*_45);}}}}for(g=0,gl=_44.length;g<gl;g++){f=_44[g];if(_2.indexOf(_44,f)===g){_4c.push(f);}}return (_4c.length)?_4c:null;}else{return map.extent.intersects(_42)?[0]:null;}},_draw:function(_4e,_4f){if(!this._params.drawMode||!this._map){return;}try{var _50=_4e._extent,_51;if(_4e.visible&&_50&&(_51=this._intersects(this._map,_50,_4e.geometry._originOnly))){if(!_4e.getDojoShape()||_4f||_51){var _52=_4e.geometry.type;if(_52==="point"){this._drawMarker(_4e,_51);this._symbolizeMarker(_4e);}else{if(_52==="multipoint"){this._drawMarkers(_4e,_51);this._symbolizeMarkers(_4e);}else{this._drawShape(_4e,_51);this._symbolizeShape(_4e);}}}}else{if(_4e.getDojoShape()){this._removeShape(_4e);}}}catch(err){this._errorHandler(err,_4e);}},_removeShape:function(_53){var _54=_53.getDojoShape();_54.removeShape();_53._shape=null;},_drawShape:function(_55,_56){var _57=_55.geometry,_58=_57.type,map=this._map,me=map.extent,mw=map.width,mh=map.height,eg=esri.geometry,_59=map.__visibleRect,_5a=[],i,il;if(_58==="rect"||_58==="extent"){var _5b;if(_58==="extent"){_5b=eg.toScreenGeometry(me,mw,mh,_57);_5b={x:_5b.xmin-_59.x+_56[0],y:_5b.ymax-_59.y,width:_5b.getWidth(),height:_5b.getHeight()};}else{var xy=eg.toScreenPoint(me,mw,mh,_57),wh=eg.toScreenPoint(me,mw,mh,{x:_57.x+_57.width,y:_57.y+_57.height});_5b={x:xy.x-_59.x+_56[0],y:xy.y-_59.y,width:wh.x-xy.x,height:xy.y-wh.y};}if(_5b.width===0){_5b.width=1;}if(_5b.height===0){_5b.height=1;}_55._shape=this._drawRect(this._div,_55.getDojoShape(),_5b);}else{if(_58==="polyline"||_58==="polygon"){for(i=0,il=_56.length;i<il;i++){_5a=_5a.concat(eg._toScreenPath(me,mw,mh,_57,-_59.x+_56[i],-_59.y));}_55._shape=this._drawPath(this._div,_55.getDojoShape(),_5a);if(this._rendererLimits){if(_58==="polyline"){this._clipPolyline(_55._shape,_57);}else{this._clipPolygon(_55._shape,_57);}}}}},_drawRect:function(_5c,_5d,_5e){return _5d?_5d.setShape(_5e):_5c.createRect(_5e);},_drawImage:function(_5f,_60,_61){return _60?_60.setShape(_61):_5f.createImage(_61);},_drawCircle:function(_62,_63,_64){return _63?_63.setShape(_64):_62.createCircle(_64);},_drawPath:(function(){if(_2.isIE<9){return function(_65,_66,_67){if(_66){return _66.setShape(_67.join(" "));}else{var p=_65.createObject(_3.gfx.EsriPath,_67.join(" "));_65._overrideSize(p.getEventSource());return p;}};}else{return function(_68,_69,_6a){return _69?_69.setShape(_6a.join(" ")):_68.createPath(_6a.join(" "));};}}()),_drawText:function(_6b,_6c,_6d){return _6c?_6c.setShape(_6d):_6b.createText(_6d);},_getSymbol:function(_6e){return _6e.symbol||(this.renderer?this.renderer.getSymbol(_6e):null)||null;},_symbolizeShape:function(_6f){var _70=this._getSymbol(_6f);var _71=_70._stroke,_72=_70._fill;if(_71===null||_72===null){_71=_70.getStroke();_72=_70.getFill();}_6f.getDojoShape().setStroke(_71).setFill(_72);_70._stroke=_71;_70._fill=_72;},_smsToPath:(function(){if(_2.isIE<9){return function(SMS,_73,x,y,xMh,xPh,yMh,yPh,_74){switch(_73){case SMS.STYLE_SQUARE:return ["M",xMh+","+yMh,"L",xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,"X","E"];case SMS.STYLE_CROSS:return ["M",x+","+yMh,"L",x+","+yPh,"M",xMh+","+y,"L",xPh+","+y,"E"];case SMS.STYLE_X:return ["M",xMh+","+yMh,"L",xPh+","+yPh,"M",xMh+","+yPh,"L",xPh+","+yMh,"E"];case SMS.STYLE_DIAMOND:return ["M",x+","+yMh,"L",xPh+","+y,x+","+yPh,xMh+","+y,"X","E"];case SMS.STYLE_TARGET:return ["M",xMh+","+yMh,"L",xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,xMh+","+yMh,"M",(xMh-_74)+","+y,"L",xMh+","+y,"M",x+","+(yMh-_74),"L",x+","+yMh,"M",(xPh+_74)+","+y,"L",xPh+","+y,"M",x+","+(yPh+_74),"L",x+","+yPh,"E"];}};}else{return function(SMS,_75,x,y,xMh,xPh,yMh,yPh,_76){switch(_75){case SMS.STYLE_SQUARE:return ["M",xMh+","+yMh,xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,"Z"];case SMS.STYLE_CROSS:return ["M",x+","+yMh,x+","+yPh,"M",xMh+","+y,xPh+","+y];case SMS.STYLE_X:return ["M",xMh+","+yMh,xPh+","+yPh,"M",xMh+","+yPh,xPh+","+yMh];case SMS.STYLE_DIAMOND:return ["M",x+","+yMh,xPh+","+y,x+","+yPh,xMh+","+y,"Z"];case SMS.STYLE_TARGET:return ["M",xMh+","+yMh,xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,xMh+","+yMh,"M",(xMh-_76)+","+y,xMh+","+y,"M",x+","+(yMh-_76),x+","+yMh,"M",(xPh+_76)+","+y,xPh+","+y,"M",x+","+(yPh+_76),x+","+yPh];}};}}()),_pathStyles:{"square":1,"cross":1,"x":1,"diamond":1,"target":1},_typeMaps:{"picturemarkersymbol":"image","textsymbol":"text"},_isInvalidShape:function(_77,_78){var _79=_78&&_78.shape&&_78.shape.type,_7a=_77&&_77.type,_7b=_77&&_77.style;if(!_7b){if(_7a){_7b=this._typeMaps[_7a];}}else{if(this._pathStyles[_7b]){_7b="path";}}if(_79&&_7b&&(_79!==_7b)){return true;}},_drawPoint:function(_7c,_7d,_7e,_7f,_80){var _81=_7e.type,map=this._map,_82=map.__visibleRect,_83=esri.geometry.toScreenPoint(map.extent,map.width,map.height,_7d).offset(-_82.x+_80[0],-_82.y),px=_83.x,py=_83.y,_84;if(this._isInvalidShape(_7e,_7f)){_7f.removeShape();_7f=null;}if(_81==="simplemarkersymbol"){var _85=_7e.style,_86=_7e.size/2,_87=Math.round,SMS=esri.symbol.SimpleMarkerSymbol;switch(_85){case SMS.STYLE_SQUARE:case SMS.STYLE_CROSS:case SMS.STYLE_X:case SMS.STYLE_DIAMOND:_84=this._drawPath(_7c,_7f,this._smsToPath(SMS,_85,px,py,_87(px-_86),_87(px+_86),_87(py-_86),_87(py+_86)));break;case SMS.STYLE_TARGET:var _88=_7e._targetWidth/2,_89=_7e._targetHeight/2;_84=this._drawPath(_7c,_7f,this._smsToPath(SMS,_85,px,py,_87(px-_88),_87(px+_88),_87(py-_89),_87(py+_89),_7e._spikeSize));break;default:_84=this._drawCircle(_7c,_7f,{cx:px,cy:py,r:_86});}}else{if(_81==="picturemarkersymbol"){var w=_7e.width,h=_7e.height;_84=this._drawImage(_7c,_7f,{x:px-(w/2),y:py-(h/2),width:w,height:h,src:_7e.url});}else{if(_81==="textsymbol"){_84=this._drawText(_7c,_7f,{type:"text",text:_7e.text,x:px,y:py,align:_7e.align,decoration:_7e.decoration,rotated:_7e.rotated,kerning:_7e.kerning});}}}_84.setTransform(_3.gfx.matrix.multiply(_3.gfx.matrix.translate(_7e.xoffset,-_7e.yoffset),_3.gfx.matrix.rotategAt(_7e.angle,_83)));_84._wrapOffsets=_80;return _84;},_symbolizePoint:function(_8a,_8b){var _8c=_8b.type;if(_8c==="picturemarkersymbol"){return;}var _8d=_8b._stroke,_8e=_8b._fill;if(_8c==="textsymbol"){_8a.setFont(_8b.font).setFill(_8b.getFill());}else{if(_8d===null||_8e===null){_8d=_8b.getStroke();_8e=_8b.getFill();}if(_8c==="simplemarkersymbol"){_8a.setFill(_8e).setStroke(_8d);}_8b._stroke=_8d;_8b._fill=_8e;}},_drawMarker:function(_8f,_90){_8f._shape=this._drawPoint(this._div,_8f.geometry,this._getSymbol(_8f),_8f.getDojoShape(),_90);},_symbolizeMarker:function(_91){this._symbolizePoint(_91.getDojoShape(),this._getSymbol(_91));},_drawMarkers:function(_92,_93){var _94=_92.geometry,_95=_94.points,_96=this._getSymbol(_92),_97=_92.getDojoShape()||this._div.createGroup(),_98,i,il=_95.length,_99=[],idx=0,j,jl=_93?_93.length:0;if(_97.children[0]&&this._isInvalidShape(_96,_97.children[0])){_97.clear();}for(i=0;i<il;i++){_98=_95[i];for(j=0;j<jl;j++){_99[0]=_93[j];this._drawPoint(_97,{x:_98[0],y:_98[1]},_96,_97.children[idx++],_99);}}var _9a=_97.children.length;if(il*_93.length<_9a){for(i=_9a-1;i>=il*_93.length;i--){_97.children[i].removeShape();}}_92._shape=_97;},_symbolizeMarkers:function(_9b){var _9c=this._getSymbol(_9b),_9d=_9b.getDojoShape(),_9e=_9d.children,i,il=_9e.length;for(i=0;i<il;i++){this._symbolizePoint(_9e[i],_9c);}},_errorHandler:function(err,_9f){var msg=esri.bundle.layers.graphics.drawingError;if(_9f){err.message=msg+"(geometry:"+(_9f.geometry?_9f.geometry.declaredClass:null)+", symbol:"+(_9f.symbol?_9f.symbol.declaredClass:null)+"): "+err.message;}else{err.message=msg+"(null): "+err.message;}this.inherited(arguments);},_rendererLimits:(function(){var _a0,_a1,_a2;if(_2.isFF){_a0=16125;_a1=-32250;_a2=32250;}else{if(_2.isIE<9){_a0=100000;_a1=-100000;_a2=100000;}else{if(_2.isChrome&&_2.isChrome<6){_a0=8150;_a1=-10000;_a2=10000;}}}if(_a0){var _a3,_a4;_a3=[-_a0,-_a0,_a0,_a0];_a4=[[[-_a0,-_a0],[_a0,-_a0]],[[_a0,-_a0],[_a0,_a0]],[[_a0,_a0],[-_a0,_a0]],[[-_a0,_a0],[-_a0,-_a0]]];return {clipLimit:_a0,rangeMin:_a1,rangeMax:_a2,clipBBox:_a3,clipSegments:_a4};}}()),_clipPolyline:function(_a5,_a6){var _a7=this._getCorners(_a5,_a6);var _a8=_a7.tl,_a9=_a7.br;var _aa=this._rendererLimits;var _ab=_aa.rangeMin,_ac=_aa.rangeMax,_ad=_aa.clipBBox,_ae=_aa.clipSegments;var _af=this._isPointWithinRange,_b0=this._isPointWithinBBox,_b1=this._getClipperIntersection,_b2=this._getPlaneIndex;if(!_af(_a8,_ab,_ac)||!_af(_a9,_ab,_ac)){if(_2.isIE<9){this._createSegments(_a5);}var _b3=[];_2.forEach(_a5.segments,function(_b4){var _b5=_b4.args,len=_b5.length,_b6=[],i;for(i=0;i<len;i+=2){var pt1=[_b5[i],_b5[i+1]];var pt2=[_b5[i+2],_b5[i+3]];var _b7=_b0(pt1,_ad);var _b8=_b0(pt2,_ad);if(_b7^_b8){var _b9=_b1([pt1,pt2],_ae);if(_b9){if(!_b7){_b6.push(_b9[1],pt2);}else{if(i){_b6.push(_b9[1]);}else{_b6.push(pt1,_b9[1]);}_b3.push(_b6);_b6=[];}}}else{if(_b7){if(i){_b6.push(pt2);}else{_b6.push(pt1,pt2);}}else{var _ba=_b2(pt1,_ad);var _bb=_b2(pt2,_ad);if(_ba===-1||_bb===-1||_ba===_bb){continue;}var _bc=_b1([pt1,pt2],_ae,true);if(_bc.length>0){if(!_bc[_ba]){_ba=_bc[_ba[0]]?_ba[0]:_ba[1];}if(!_bc[_bb]){_bb=_bc[_bb[0]]?_bb[0]:_bb[1];}var _bd=_bc[_ba],_be=_bc[_bb];if(_bd){_b6.push(_bd);}if(_be){_b6.push(_be);_b3.push(_b6);_b6=[];}}}}}_b3.push(_b6);});_a5.setShape(this._getPathStringFromPaths(_b3));}},_clipPolygon:function(_bf,_c0){var _c1=this._getCorners(_bf,_c0);var _c2=_c1.tl,_c3=_c1.br;var _c4=this._rendererLimits;var _c5=_c4.clipLimit,_c6=_c4.rangeMin,_c7=_c4.rangeMax,_c8=_c4.clipBBox,_c9=_c4.clipSegments;var _ca=this._isPointWithinRange,_cb=this._isPointWithinBBox,_cc=this._getClipperIntersection,_cd=this._getPlaneIndex,_ce=esri.geometry._pointLineDistance;if(!_ca(_c2,_c6,_c7)||!_ca(_c3,_c6,_c7)){if(_2.isIE<9){this._createSegments(_bf);}var _cf=_2.map(_bf.segments,function(_d0){var _d1=_d0.args,len=_d1.length,_d2=[],_d3=[],i;for(i=0;i<len;i+=2){var pt1=[_d1[i],_d1[i+1]];var pt2=[_d1[i+2],_d1[i+3]];if(i===(len-2)){_d2.push(pt1);break;}var _d4=_cb(pt1,_c8);var _d5=_cb(pt2,_c8);_d2.push(pt1);if(_d4^_d5){var _d6=_cc([pt1,pt2],_c9);if(_d6){var _d7=_d6[1];_d7[_d4?"inOut":"outIn"]=true;_d2.push(_d7);_d3.push([_d4?"INOUT":"OUTIN",_d2.length-1,_d6[0]]);}}else{if(!_d4){var _d8=_cd(pt1,_c8);var _d9=_cd(pt2,_c8);if(_d8===-1||_d9===-1||_d8===_d9){continue;}var _d6=_cc([pt1,pt2],_c9,true);if(_d6.length>0){if(!_d6[_d8]){_d8=_d6[_d8[0]]?_d8[0]:_d8[1];}if(!_d6[_d9]){_d9=_d6[_d9[0]]?_d9[0]:_d9[1];}var _da=_d6[_d8],_db=_d6[_d9];if(_da){_da.outIn=true;_d2.push(_da);_d3.push(["OUTIN",_d2.length-1,_d8]);}if(_db){_db.inOut=true;_d2.push(_db);_d3.push(["INOUT",_d2.length-1,_d9]);}}else{if(_2.isArray(_d8)&&_2.isArray(_d9)){var _dc=_d8.concat(_d9);_dc.sort();if(_dc.join("")==="0123"){var _dd=[];if((_d8[0]+_d8[1])===3){_dd.push([_c5,-_c5],[-_c5,_c5]);}else{_dd.push([-_c5,-_c5],[_c5,_c5]);}var d1=_ce(_dd[0],[pt1,pt2]);var d2=_ce(_dd[1],[pt1,pt2]);_d2.push((d1<d2)?_dd[0]:_dd[1]);}}}}}}var _de=_c8[0],_df=_c8[1],_e0=_c8[2],_e1=_c8[3];_2.forEach(_d2,function(_e2){if(_e2[0]<_de){if(_e2[1]>=_df&&_e2[1]<=_e1){_e2[0]=_de;}else{_e2[0]=_de;_e2[1]=_e2[1]<_df?_df:_e1;}}});_2.forEach(_d2,function(_e3){if(_e3[1]<_df){if(_e3[0]>=_de&&_e3[0]<=_e0){_e3[1]=_df;}else{_e3[1]=_df;_e3[0]=_e3[0]<_de?_de:_e0;}}});_2.forEach(_d2,function(_e4){if(_e4[0]>_e0){if(_e4[1]>=_df&&_e4[1]<=_e1){_e4[0]=_e0;}else{_e4[0]=_e0;_e4[1]=_e4[1]<_df?_df:_e1;}}});_2.forEach(_d2,function(_e5){if(_e5[1]>_e1){if(_e5[0]>=_de&&_e5[0]<=_e0){_e5[1]=_e1;}else{_e5[1]=_e1;_e5[0]=_e5[0]<_de?_de:_e0;}}});var k=0,len=_d3.length;if(len>0){do{var _e6=_d3[k];var _e7=_d3[(k+1)%len];if(_e6[2]===_e7[2]&&_e6[0]==="INOUT"&&_e7[0]==="OUTIN"){var _e8=_e6[1],end=_e7[1],u;if(_e8<end){for(u=_e8+1;u<end;u++){_d2[u][2]=true;}}else{if(_e8>end){for(u=_e8+1;u<_d2.length;u++){_d2[u][2]=true;}for(u=0;u<end;u++){_d2[u][2]=true;}}}}k=(k+1)%len;}while(k!==0);}var _e9=_d2[0],_ea=_d2[_d2.length-1];if(_e9[2]){_ea[2]=true;_2.some(_d3,function(_eb){if(_eb[1]===1){_d2.splice(_d2.length-1,0,_2.clone(_d2[1]));return true;}return false;});}_d2=_2.filter(_d2,function(_ec){return _ec[2]?false:true;});for(k=0;k<_d2.length-1;k++){var now=_d2[k];var _e7=_d2[k+1];if(!_e7||(now[0]!==_e7[0])||(now[1]!==_e7[1])){continue;}if(_e7.outIn){now.outIn=true;}else{if(_e7.inOut){now.inOut=true;}}_d2.splice(k+1,1);}var abs=Math.abs,_ed=[];for(k=0;k<_d2.length-1;k++){var _e6=_d2[k],cx=_e6[0],cy=_e6[1];var x1=(abs(cx)===_c5);var y1=(abs(cy)===_c5);var _e7=_d2[k+1],nx=_e7[0],ny=_e7[1];var x2=(abs(nx)===_c5);var y2=(abs(ny)===_c5);if(x1&&y2){_ed.push([k+1,[cx,ny]]);}else{if(y1&&x2){_ed.push([k+1,[nx,cy]]);}}}for(k=_ed.length-1;k>=0;k--){var _ee=_ed[k];var _ef=_d2[_ee[0]-1];var now=_d2[_ee[0]];if(_ef.outIn||_ef.inOut||now.outIn||now.inOut){continue;}_d2.splice(_ee[0],0,_ee[1]);}var _e9=_d2[0],_ea=_d2[_d2.length-1];if(_e9[0]!==_ea[0]||_e9[1]!==_ea[1]){_d2.push(_e9);}return _d2;});_bf.setShape(this._getPathStringFromPaths(_cf));}},_getCorners:function(_f0,_f1){if(_2.isIE<9){var map=this._map;var _f2=_f1.getExtent();var _f3=map.toScreen(new esri.geometry.Point(_f2.xmin,_f2.ymax));var _f4=map.toScreen(new esri.geometry.Point(_f2.xmax,_f2.ymin));return {tl:_f3,br:_f4};}else{var _f5=_f0.getTransformedBoundingBox();return {tl:_f5[0],br:_f5[2]};}},_createSegments:function(_f6){_f6.shape.path=_f6.vmlPath;_f6.segmented=false;_f6._confirmSegmented();var _f7=_f6.segments;if(_f7.length>1){_f6.segments=_2.filter(_f7,function(_f8,idx,arr){var _f9=arr[idx+1];if(_f8.action==="M"&&_f9&&_f9.action==="L"){_f8.args=_f8.args.concat(_f9.args);return true;}return false;});}},_getPathStringFromPaths:function(_fa){if(_2.isIE<9){_fa=_2.map(_fa,function(_fb){var _fc=_2.map(_fb,function(_fd,idx){return (idx===1?"l ":"")+_fd.join(",");});return "m "+_fc.join(" ");});_fa.push("e");}else{_fa=_2.map(_fa,function(_fe){var _ff=_2.map(_fe,function(_100){return _100.join(",");});return "M "+_ff.join(" ");});}return _fa.join(" ");},_isPointWithinBBox:function(_101,bbox){var left=bbox[0],top=bbox[1];var _102=bbox[2],_103=bbox[3];var x=_101[0],y=_101[1];if(x>left&&x<_102&&y>top&&y<_103){return true;}else{return false;}},_isPointWithinRange:function(_104,_105,_106){var x=_104.x,y=_104.y;if(x<_105||y<_105||x>_106||y>_106){return false;}else{return true;}},_getClipperIntersection:function(line,_107,_108){var i,_109=esri.geometry._getLineIntersection2,_10a=Math.round,data={length:0};for(i=0;i<4;i++){var _10b=_109(line,_107[i]);if(_10b){_10b[0]=_10a(_10b[0]);_10b[1]=_10a(_10b[1]);if(!_108){return [i,_10b];}else{data[i]=_10b;data.length++;}}}return _108?data:null;},_getPlaneIndex:function(_10c,_10d){var px=_10c[0],py=_10c[1],xmin=_10d[0],ymin=_10d[1],xmax=_10d[2],ymax=_10d[3];if(px<=xmin){if((py>=ymin)&&(py<=ymax)){return 3;}else{return (py<ymin)?[0,3]:[2,3];}}if(py<=ymin){if((px>=xmin)&&(px<=xmax)){return 0;}else{return (px<xmin)?[3,0]:[1,0];}}if(px>=xmax){if((py>=ymin)&&(py<=ymax)){return 1;}else{return (py<ymin)?[0,1]:[2,1];}}if(py>=ymax){if((px>=xmin)&&(px<=xmax)){return 2;}else{return (px<xmin)?[3,2]:[1,2];}}return -1;},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicsClear:function(){},onOpacityChange:function(){},setInfoTemplate:function(_10e){this.infoTemplate=_10e;},add:function(_10f){var _110=arguments[1];if(_10f._graphicsLayer===this){return _10f;}if(!_110){this.graphics.push(_10f);}_10f._graphicsLayer=this;this._updateExtent(_10f);this._draw(_10f);if(!_110){this.onGraphicAdd(_10f);}return _10f;},remove:function(_111){if(!arguments[1]){var _112=this.graphics,i;if((i=_2.indexOf(_112,_111))===-1){return null;}_111=this.graphics.splice(i,1)[0];}if(_111.getDojoShape()){this._removeShape(_111);}_111._shape=_111._graphicsLayer=null;this.onGraphicRemove(_111);return _111;},clear:function(){var _113=arguments[1],g=this.graphics;while(g.length>0){this.remove(g[0]);}if(!_113){this.onGraphicsClear();}},setOpacity:function(op,_114){if(_114||this.opacity!=op){var div=this._div;if(div){if(_2.isIE<9){_2.forEach(this.graphics,function(_115){var _116=_115._shape;var node=_116&&_116.getNode();if(node){var _117=_116.strokeStyle,_118=node.stroke;if(_117&&_118){_118.opacity=_117.color.a*op;}var _119=_116.fillStyle,fill=node.fill;if(_119&&fill){if(fill.type==="tile"){_2.style(node,"opacity",op);}else{fill.opacity=_119.a*op;}}}});div._esriIeOpacity=op;}else{if(this._canvas){_2.style(div.getEventSource(),"opacity",op);}else{div.getEventSource().setAttribute("opacity",op);}}}this.opacity=op;if(!_114){this.onOpacityChange(op);}}},setRenderer:function(ren){this.renderer=ren;}});_2.declare("esri.layers.GraphicsLayer",esri.layers._GraphicsLayer,{constructor:function(){this.enableMouseEvents=_2.hitch(this,this.enableMouseEvents);this.disableMouseEvents=_2.hitch(this,this.disableMouseEvents);this._processEvent=_2.hitch(this,this._processEvent);this._initLayer();},_initLayer:function(){this.loaded=true;this.onLoad(this);},_setMap:function(){var d=this.inherited("_setMap",arguments);this.enableMouseEvents();return d;},_unsetMap:function(){this.disableMouseEvents();this.inherited("_unsetMap",arguments);},_processEvent:function(evt){var _11a=this._map,g=this.graphics,gl=g.length;evt.screenPoint=new esri.geometry.Point(evt.pageX-_11a.position.x,evt.pageY-_11a.position.y);evt.mapPoint=_11a.toMap(evt.screenPoint);var i,es,gr,ds,_11b=evt.target,_11c=_11b.parentNode;for(i=0;i<gl;i++){gr=g[i];ds=gr.getDojoShape();if(ds){es=ds.getEventSource();if(es===_11b||es===_11c){evt.graphic=gr;return evt;}}}},_onMouseOverHandler:function(evt){if(this._processEvent(evt)){this.onMouseOver(evt);}},_onMouseMoveHandler:function(evt){if(this._processEvent(evt)){this.onMouseMove(evt);}},_onMouseDragHandler:function(evt){if(this._processEvent(evt)){this.onMouseDrag(evt);}},_onMouseOutHandler:function(evt){if(this._processEvent(evt)){this.onMouseOut(evt);}},_onMouseDownHandler:function(evt){this._downGr=this._downPt=null;if(this._processEvent(evt)){_2.disconnect(this._onmousemove_connect);_2.disconnect(this._onmousedrag_connect);this._onmousedrag_connect=_2.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler");this._downGr=evt.graphic;this._downPt=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseDown(evt);}},_onMouseUpHandler:function(evt){this._upGr=this._upPt=null;if(this._processEvent(evt)){_2.disconnect(this._onmousedrag_connect);_2.disconnect(this._onmousemove_connect);this._onmousemove_connect=_2.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler");this._upGr=evt.graphic;this._upPt=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseUp(evt);}},_onClickHandler:function(evt){if(this._processEvent(evt)){var _11d=this._downGr,upGr=this._upGr;if(_11d&&upGr&&_11d===upGr&&this._downPt===this._upPt){if(_2.isIE<9){esri.layers.GraphicsLayer._clicked=evt.graphic;}this.onClick(evt);}}},_onDblClickHandler:function(evt){if(this._processEvent(evt)){this.onDblClick(evt);}},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(this._mouseEvents){return;}var dc=_2.connect,gc=this._div.getEventSource();if(_3.gfx.renderer.toLowerCase().indexOf("canvas")===-1){this._onmouseover_connect=dc(gc,"onmouseover",this,"_onMouseOverHandler");this._onmousemove_connect=dc(gc,"onmousemove",this,"_onMouseMoveHandler");this._onmouseout_connect=dc(gc,"onmouseout",this,"_onMouseOutHandler");this._onmousedown_connect=dc(gc,"onmousedown",this,"_onMouseDownHandler");this._onmouseup_connect=dc(gc,"onmouseup",this,"_onMouseUpHandler");this._onclick_connect=dc(gc,"onclick",this,"_onClickHandler");this._ondblclick_connect=dc(gc,"ondblclick",this,"_onDblClickHandler");}this._mouseEvents=true;},disableMouseEvents:function(){if(!this._mouseEvents){return;}var ddc=_2.disconnect;ddc(this._onmouseover_connect);ddc(this._onmousemove_connect);ddc(this._onmousedrag_connect);ddc(this._onmouseout_connect);ddc(this._onmousedown_connect);ddc(this._onmouseup_connect);ddc(this._onclick_connect);ddc(this._ondblclick_connect);this._mouseEvents=false;}});});