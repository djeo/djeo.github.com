/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/toolbars/_toolbar,esri/toolbars/_GraphicMover,esri/toolbars/_VertexEditor,esri/toolbars/_Box"],function(_1,_2,_3){_2.provide("esri.toolbars.edit");_2.require("esri.toolbars._toolbar");_2.require("esri.toolbars._GraphicMover");_2.require("esri.toolbars._VertexEditor");_2.require("esri.toolbars._Box");(function(){var _4=document.createElement("link");_4.type="text/css";_4.rel="stylesheet";_4.href=_2.moduleUrl("esri","toolbars/css/edit.css").toString();document.getElementsByTagName("head").item(0).appendChild(_4);}());_2.declare("esri.toolbars.Edit",esri.toolbars._Toolbar,{constructor:function(_5,_6){this._map=_5;this._tool=0;this._scratchGL=_5.graphics;var _7=esri.isTouchEnabled;this._defaultOptions=_2.mixin({vertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,_7?20:12,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([0,0,0,0.5]),1),new _2.Color([128,128,128])),ghostVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,_7?18:10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([0,0,0,0.5]),1),new _2.Color([255,255,255,0.75])),ghostLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DOT,new _2.Color([128,128,128]),2),allowDeleteVertices:true,allowAddVertices:true,rotateHandleOffset:_7?24:16,boxLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new _2.Color([64,64,64]),1),boxHandleSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,_7?16:9,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new _2.Color([0,0,0,0.5]),1),new _2.Color([255,255,255,0.75]))},_6||{});},activate:function(_8,_9,_a){this.deactivate();this._graphic=_9;this._options=_2.mixin(_2.mixin({},this._defaultOptions),_a||{});var _b=esri.toolbars.Edit.MOVE,_c=esri.toolbars.Edit.EDIT_VERTICES;var _d=esri.toolbars.Edit.SCALE,_e=esri.toolbars.Edit.ROTATE;var _f=false,_10=false,box=false;if((_8&_b)===_b){_f=this._enableMove(_9);}var _11=((_8&_d)===_d),_12=((_8&_e)===_e);if(_11||_12){box=this._enableBoxEditing(_9,_11,_12);}if((_8&_c)===_c){_10=this._enableVertexEditing(_9);}if(!(_f||_10||box)){throw new Error("[esri.toolbars.Edit::activate] "+esri.bundle.toolbars.edit.invalidType);}this._tool=_8;var map=this._map;if(this._tool){this._mapPanEndHandle=_2.connect(map,"onPanEnd",this,this._mapPanEndHandler);this._mapExtChgHandle=_2.connect(map,"onExtentChange",this,this._mapExtentChangeHandler);this.onActivate(this._tool,_9);}if(map.snappingManager&&(_f||_10)){map.snappingManager._startSelectionLayerQuery();}},deactivate:function(){var _13=this._tool,_14=this._graphic;if(!_13){return;}var _15=!!this._modified;this._clear();_2.disconnect(this._mapPanEndHandle);_2.disconnect(this._mapExtChgHandle);this._graphic=null;this.onDeactivate(_13,_14,{isModified:_15});if(this._map.snappingManager){this._map.snappingManager._stopSelectionLayerQuery();}},refresh:function(){this._refreshMoveables(true);},getCurrentState:function(){return {tool:this._tool,graphic:this._graphic,isModified:!!this._modified};},onActivate:function(_16,_17){},onDeactivate:function(_18,_19,_1a){},onGraphicMoveStart:function(_1b){},onGraphicFirstMove:function(_1c){this._modified=true;},onGraphicMove:function(_1d,_1e){},onGraphicMoveStop:function(_1f,_20){},onGraphicClick:function(_21,_22){},onVertexMoveStart:function(_23,_24){},onVertexFirstMove:function(_25,_26){this._modified=true;},onVertexMove:function(_27,_28,_29){},onVertexMoveStop:function(_2a,_2b,_2c){},onVertexAdd:function(_2d,_2e){this._modified=true;},onVertexClick:function(_2f,_30){},onVertexMouseOver:function(_31,_32){},onVertexMouseOut:function(_33,_34){},onVertexDelete:function(_35,_36){this._modified=true;},onScaleStart:function(_37){},onScaleFirstMove:function(_38){this._modified=true;},onScale:function(_39,_3a){},onScaleStop:function(_3b,_3c){},onRotateStart:function(_3d){},onRotateFirstMove:function(_3e){this._modified=true;},onRotate:function(_3f,_40){},onRotateStop:function(_41,_42){},_enableMove:function(_43){var map=this._map,_44=_43.geometry.type;switch(_44){case "point":case "polyline":case "polygon":this._graphicMover=new esri.toolbars._GraphicMover(_43,map,this);return true;case "multipoint":break;}return false;},_enableVertexEditing:function(_45){var map=this._map,_46=_45.geometry.type;switch(_46){case "point":break;case "multipoint":case "polyline":case "polygon":this._vertexEditor=esri.toolbars._GraphicVertexEditor.create(_45,map,this);return true;}return false;},_enableBoxEditing:function(_47,_48,_49){var map=this._map,_4a=_47.geometry.type;switch(_4a){case "point":case "multipoint":break;case "polyline":case "polygon":this._boxEditor=new esri.toolbars._Box(_47,map,this,_48,_49);return true;}return false;},_disableMove:function(){var _4b=this._graphicMover;if(_4b){_4b.destroy();this._graphicMover=null;}},_disableVertexEditing:function(){var _4c=this._vertexEditor;if(_4c){_4c.destroy();this._vertexEditor=null;}},_disableBoxEditing:function(){var box=this._boxEditor;if(box){box.destroy();this._boxEditor=null;}},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._tool=0;this._modified=false;},_mapPanEndHandler:function(){this._refreshMoveables();},_mapExtentChangeHandler:function(e,d,_4d){if(_4d){this._refreshMoveables();}},_refreshMoveables:function(_4e){var _4f=_2.filter([this._graphicMover,this._vertexEditor,this._boxEditor],esri._isDefined);_2.forEach(_4f,function(mov){mov.refresh(_4e);});},_beginOperation:function(_50){_2.forEach(this._getAffectedTools(_50),function(_51){_51.suspend();});},_endOperation:function(_52){_2.forEach(this._getAffectedTools(_52),function(_53){_53.resume();});},_getAffectedTools:function(_54){var _55=[];switch(_54){case "MOVE":_55=[this._vertexEditor,this._boxEditor];break;case "VERTICES":_55=[this._boxEditor];break;case "BOX":_55=[this._vertexEditor];break;}_55=_2.filter(_55,esri._isDefined);return _55;}});_2.mixin(esri.toolbars.Edit,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8});});