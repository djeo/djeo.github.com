/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/tasks/na,esri/tasks/gp,esri/utils"],function(_1,_2,_3){_2.provide("esri.tasks.route");_2.require("esri.tasks.na");_2.require("esri.tasks.gp");_2.require("esri.utils");_2.declare("esri.tasks.RouteTask",esri.tasks._Task,{constructor:function(_4){this._url.path+="/solve";this._handler=_2.hitch(this,this._handler);},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(_5,io,_6,_7,_8){try{var _9=[],_a=[],_b=_5.directions||[],_c=_5.routes?_5.routes.features:[],_d=_5.stops?_5.stops.features:[],_e=_5.barriers?_5.barriers.features:[],_f=_5.polygonBarriers?_5.polygonBarriers.features:[],_10=_5.polylineBarriers?_5.polylineBarriers.features:[],_11=_5.messages,_12="esri.tasks.RouteTask.NULL_ROUTE_NAME",_13=_2.forEach,_14=_2.indexOf,_15=true,_16,_17;_13(_b,function(dir){_9.push(_16=dir.routeName);_a[_16]={directions:dir};});_13(_c,function(_18){if(_14(_9,(_16=_18.attributes.Name))===-1){_9.push(_16);_a[_16]={};}_a[_16].route=_18;});_13(_d,function(_19){_17=_19.attributes;if(_14(_9,(_16=_17.RouteName||_12))===-1){_9.push(_16);_a[_16]={};}if(_16!==_12){_15=false;}if(_a[_16].stops===undefined){_a[_16].stops=[];}_a[_16].stops.push(_19);});if(_d.length>0&&_15===true){_a[_9[0]].stops=_a[_12].stops;delete _a[_12];_9.splice(_2.indexOf(_9,_12),1);}var _1a=[];_13(_9,function(_1b,i){_a[_1b].routeName=_1b===_12?null:_1b;_1a.push(new esri.tasks.RouteResult(_a[_1b]));});var _1c=function(_1d){_13(_1d,function(_1e,i){_1d[i]=new esri.Graphic(_1e);});return _1d;};_13(_11,function(_1f,i){_11[i]=new esri.tasks.NAMessage(_1f);});var _20={routeResults:_1a,barriers:_1c(_e),polygonBarriers:_1c(_f),polylineBarriers:_1c(_10),messages:_11};this._successHandler([_20],"onSolveComplete",_6,_8);}catch(err){this._errorHandler(err,_7,_8);}},solve:function(_21,_22,_23,_24){var _25=_21.stops;if(_25&&_25 instanceof esri.tasks.FeatureSet){var _26=[],_27=false,_28;_2.forEach(_25.features,function(_29){_28=_29.attributes;if((!_28||!_28.RouteName)&&!_27){_27=true;}else{if(_2.indexOf(_26,_28?_28.RouteName:"")===-1){_26.push(_28?_28.RouteName:"");}}});if(_26.length>1&&_27){_27=new Error(esri.bundle.tasks.na.route.routeNameNotSpecified);this.onError(_27);if(_23){_23(_27);}throw _27;}}var _2a=_24.assembly,_2b=this._encode(_2.mixin({},this._url.query,{f:"json"},_21.toJson(_2a&&_2a[0]))),_2c=this._handler,_2d=this._errorHandler;return esri.request({url:this._url.path,content:_2b,callbackParamName:"callback",load:function(r,i){_2c(r,i,_22,_23,_24.dfd);},error:function(r){_2d(r,_23,_24.dfd);}});},onSolveComplete:function(){}});esri._createWrappers("esri.tasks.RouteTask");_2.declare("esri.tasks.RouteParameters",null,{accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:false,findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:null,outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:false,returnDirections:false,returnPolygonBarriers:false,returnPolylineBarriers:false,returnRoutes:true,returnStops:false,startTime:null,stops:null,useHierarchy:null,useTimeWindows:null,toJson:function(_2e){var _2f={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&_2.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?(this.outSpatialReference.wkid||_2.toJson(this.outSpatialReference.toJson())):null,outputLines:this.outputLines,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:esri.tasks._NALengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute},_30=this.stops;if(_30 instanceof esri.tasks.FeatureSet&&_30.features.length>0){_2f.stops=_2.toJson({type:"features",features:esri._encodeGraphics(_30.features,_2e&&_2e["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements});}else{if(_30 instanceof esri.tasks.DataLayer){_2f.stops=_30;}else{if(_30 instanceof esri.tasks.DataFile){_2f.stops=_2.toJson({type:"features",url:_30.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements});}}}var _31=function(_32,_33){if(!_32){return null;}if(_32 instanceof esri.tasks.FeatureSet){if(_32.features.length>0){return _2.toJson({type:"features",features:esri._encodeGraphics(_32.features,_2e&&_2e[_33])});}else{return null;}}else{if(_32 instanceof esri.tasks.DataLayer){return _32;}else{if(_32 instanceof esri.tasks.DataFile){return _2.toJson({type:"features",url:_32.url});}}}return _2.toJson(_32);};if(this.barriers){_2f.barriers=_31(this.barriers,"barriers.features");}if(this.polygonBarriers){_2f.polygonBarriers=_31(this.polygonBarriers,"polygonBarriers.features");}if(this.polylineBarriers){_2f.polylineBarriers=_31(this.polylineBarriers,"polylineBarriers.features");}return esri.filter(_2f,function(_34){if(_34!==null){return true;}});}});_2.declare("esri.tasks.RouteResult",null,{constructor:function(_35){if(_35.directions){var cgs=[];_2.forEach(_35.directions.features,function(f,i){cgs[i]=f.compressedGeometry;});this.directions=new esri.tasks.DirectionsFeatureSet(_35.directions,cgs);}this.routeName=_35.routeName;if(_35.route){this.route=new esri.Graphic(_35.route);}if(_35.stops){var ss=(this.stops=[]);_2.forEach(_35.stops,function(_36,i){ss[_36.attributes.Sequence-1]=new esri.Graphic(_36);});}},routeName:null,directions:null,route:null,stops:null});});